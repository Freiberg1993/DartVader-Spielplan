
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>DartVader Turnierplan</title>

  <!-- Basis-Styles f√ºr deine Seite -->
  <style>
    :root { --fg:#111; --muted:#555; --border:#ddd; --bg:#fff; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.4}
    main{max-width:1000px;margin:24px auto;padding:0 16px}
    h1,h2,h3,h4{margin:0.6em 0}
    table{width:100%;border-collapse:collapse;margin:8px 0 16px;border:1px solid var(--border)}
    th,td{border:1px solid var(--border);padding:6px 8px;text-align:left;vertical-align:top}
    small,em{color:var(--muted)}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin:6px 0 8px}
    .pill{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:2px 8px;background:#f8f8f8}
    .muted{color:var(--muted)}

    /* ‚Äî Widget oben rechts ‚Äî */
    #highest-throw{
      position:fixed;top:12px;right:12px;z-index:9999;
      border:1px solid #ddd;border-radius:8px;padding:12px;background:#fff;width:320px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
    }
    #highest-throw h3{margin:0 0 6px 0;font-size:1.05rem}
    #ht-status{color:#555;font-size:.85rem}
    .ht-grid{display:grid;grid-template-columns:1fr;gap:8px;margin:8px 0}
    .ht-field{display:flex;flex-direction:column;gap:6px}
    .ht-field>span{font-size:.9rem;color:#555}
    .ht-actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn-primary{background:#2a7;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    .btn-secondary{background:#eee;color:#333;border:1px solid #ccc;padding:8px 12px;border-radius:6px;cursor:pointer}
    .btn-primary:hover{background:#268a60}.btn-secondary:hover{background:#e5e5e5}
    #ht-current{font-size:.95rem;margin-top:8px}
    #ht-current-line{margin-top:4px}
    @media (max-width:560px){ #highest-throw{ position:static;width:auto;margin:8px } }
  </style>
</head>
<body>

  <!-- üîπ Widget: H√∂chster Wurf (oben rechts) -->
  <section id="highest-throw" aria-label="H√∂chster Wurf">
    <h3>üéØ H√∂chster Wurf</h3>
    <small id="ht-status" aria-live="polite"></small>

    <div class="ht-grid">
      <label class="ht-field">
        <span>Teilnehmer</span>
        <select id="ht-player" aria-label="Teilnehmer ausw√§hlen"></select>
      </label>

      <label class="ht-field">
        <span>H√∂chster Wurf (0‚Äì1000)</span>
        <input type="number" id="ht-score" inputmode="numeric" min="0" max="1000" step="1" placeholder="z.‚ÄØB. 140">
      </label>
    </div>

    <div class="ht-actions">
      <button id="ht-save" class="btn-primary">Speichern</button>
      <button id="ht-reset" class="btn-secondary" title="Eintrag l√∂schen">Zur√ºcksetzen</button>
    </div>

    <div id="ht-current">
      <strong>Aktueller Eintrag:</strong>
      <div id="ht-current-line">‚Äì noch kein Eintrag ‚Äì</div>
    </div>
  </section>
  <!-- üîπ Ende Widget -->

  <!-- Dein bisheriger Inhalt (aus deiner Datei √ºbernommen) -->
  <main>
    <h1>DartVader Turnierplan ‚Äì Fairplay strikt (gespielt statt geplant)</h1> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->
    <h2>DartVader Turnierplan</h2> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <p>Fairplay-Regeln STRIKT: niemand spielt 2√ó in Folge, niemand wartet 3√ó in Folge. R√ºckrunde automatisch; Grenze konfliktfrei.</p> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->
    <p class="pill">‚ö°Ô∏è Fairplay aktiv</p> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <h3>Teilnehmer</h3> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <div class="controls">
      <span class="pill">‚ûï Spieler hinzuf√ºgen</span>
      <span class="pill">üßπ Ergebnisse zur√ºcksetzen</span>
    </div> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <!-- Teilnehmer-Tabelle: erste Spalte "Name" wird vom Widget ausgelesen -->
    <table id="teilnehmer">
      <tr>
        <th>Name</th>
        <th>Gespielt</th>
        <th>Siege</th>
        <th>Niederlagen</th>
        <th>Aktion</th>
      </tr>
      <!-- Beispielzeilen ‚Äì f√ºge hier deine Spieler hinzu:
      <tr><td>Kai</td><td>0</td><td>0</td><td>0</td><td>‚Äì</td></tr>
      <tr><td>Max</td><td>0</td><td>0</td><td>0</td><td>‚Äì</td></tr>
      -->
    </table> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <p class="muted">Tipp: Namen doppelklicken zum Bearbeiten.</p> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <h3>Spielplan</h3> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <div class="controls">
      <span class="pill">üîÑ Zuf√§llige Paarungen (FAIR, strikt)</span>
      <span class="pill">üîÄ Reihenfolge mischen (FAIR beibehalten)</span>
    </div> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <h4>Hinrunde</h4>
    <table>
      <tr>
        <th>#</th>
        <th>Spieler A</th>
        <th>Spieler B</th>
        <th>Sieger</th>
      </tr>
    </table> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <h4>R√ºckrunde</h4>
    <table>
      <tr>
        <th>#</th>
        <th>Spieler A</th>
        <th>Spieler B</th>
        <th>Sieger</th>
      </tr>
    </table> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->

    <p class="muted">Made for DartVader ‚Ä¢ Lokale Speicherung aktiv</p> <!-- [1](https://whegroup-my.sharepoint.com/personal/kai_freiberg_e-t-z_eu/Documents/Microsoft%20Copilot%20Chat-Dateien/index.html) -->
  </main>

  <!-- Logik f√ºr das Widget (ohne Template-Strings, sehr kompatibel) -->
  <script>
    (function(){
      var STORAGE_KEY = 'dartHighestNoDateV1';
      var ONLY_UPDATE_IF_HIGHER = true;

      function $(sel){ return document.querySelector(sel); }
      function normalizeName(s){ return (s || '').toString().trim(); }
      function uniqSorted(arr){
        var map = {}; var out = [];
        for (var i=0;i<arr.length;i++){
          var n = normalizeName(arr[i]); if(!n) continue;
          if(!map[n]){ map[n]=1; out.push(n); }
        }
        out.sort(function(a,b){ return a.localeCompare(b,'de'); });
        return out;
      }

      function readStorage(){
        try { var raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : null; }
        catch(e){ return null; }
      }
      function writeStorage(obj){
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); } catch(e){}
      }

      function findPlayersFromTable(){
        // Suche erste Tabelle mit Header "Name"
        var tables = document.querySelectorAll('table');
        for (var t=0; t<tables.length; t++){
          var table = tables[t];
          var heads = table.querySelectorAll('thead th');
          var hasThead = heads.length > 0;
          var headerCells = hasThead ? heads : table.querySelectorAll('tr:first-child th');
          var hasName = false;
          for (var h=0; h<headerCells.length; h++){
            var txt = (headerCells[h].textContent || '').trim();
            if (/(^|\s)name(\s|$)/i.test(txt)) { hasName = true; break; }
          }
          if (!hasName) continue;

          var rows = table.querySelectorAll('tbody tr');
          var useGeneric = rows.length === 0;
          var dataRows = useGeneric ? table.querySelectorAll('tr') : rows;
          var names = [];
          for (var r=useGeneric?1:0; r<dataRows.length; r++){ // starte bei 1 wenn kein tbody => Header √ºberspringen
            var row = dataRows[r];
            var cell = row.querySelector('td, th');
            if (!cell) continue;
            var name = cell.textContent.replace(/\s+/g,' ').trim();
            if (name) names.push(name);
          }
          if (names.length) return uniqSorted(names);
        }
        return [];
      }

      function populatePlayers(){
        var select = $('#ht-player');
        var status = $('#ht-status');
        var players = findPlayersFromTable();
        // leeren
        while (select.firstChild) select.removeChild(select.firstChild);

        if (players.length === 0){
          var opt = document.createElement('option');
          opt.value = ''; opt.textContent = '‚Äî keine Spieler gefunden ‚Äî';
          select.appendChild(opt);
          select.disabled = true;
          status.textContent = 'Spielerliste: nicht gefunden (pr√ºfe Spaltenkopf "Name").';
          return;
        }
        for (var i=0;i<players.length;i++){
          var op = document.createElement('option');
          op.value = players[i];
          op.textContent = players[i];
          select.appendChild(op);
        }
        select.disabled = false;
        status.textContent = 'Spielerliste aus Tabelle geladen.';
      }

      function renderCurrent(){
        var line = $('#ht-current-line');
        var rec = readStorage();
        if (rec && rec.name && typeof rec.score === 'number' && isFinite(rec.score)){
          line.textContent = rec.score + ' ‚Äì ' + rec.name;
        } else {
          line.textContent = '‚Äì noch kein Eintrag ‚Äì';
        }
      }

      function save(){
        var status = $('#ht-status');
        var name  = normalizeName($('#ht-player').value);
        var score = Number($('#ht-score').value);
        if (!name){ alert('Bitte Teilnehmer w√§hlen.'); return; }
        if (!isFinite(score) || score < 0 || score > 1000){ alert('Bitte g√ºltige Punktzahl (0‚Äì1000) eintragen.'); return; }

        var current = readStorage();
        if (!ONLY_UPDATE_IF_HIGHER || !current || score > current.score){
          writeStorage({ name: name, score: score });
          status.textContent = ONLY_UPDATE_IF_HIGHER ? 'Rekord aktualisiert ‚úÖ' : 'Eintrag gespeichert.';
          $('#ht-score').value = '';
          renderCurrent();
        } else {
          status.textContent = 'Kein Update: ' + score + ' < ' + current.score + ' (aktueller Wert)';
        }
      }

      function resetEntry(){
        if (confirm('Eintrag wirklich l√∂schen?')){
          localStorage.removeItem(STORAGE_KEY);
          $('#ht-status').textContent = 'Eintrag gel√∂scht üóëÔ∏è';
          renderCurrent();
        }
      }

      function watchPlayers(){
        // Aktualisiert Dropdown bei √Ñnderungen in der Tabelle (Spieler hinzuf√ºgen/√§ndern)
        var mo = new MutationObserver(function(muts){
          var needUpdate = false;
          for (var i=0;i<muts.length;i++){
            var m = muts[i];
            if (m.type === 'childList' || m.type === 'characterData'){
              needUpdate = true; break;
            }
          }
          if (needUpdate){
            var prev = $('#ht-player').value;
            populatePlayers();
            if (prev){
              var opts = $('#ht-player').options;
              for (var j=0;j<opts.length;j++){
                if (opts[j].value === prev){ $('#ht-player').value = prev; break; }
              }
            }
          }
        });
        mo.observe(document.body, { childList:true, subtree:true, characterData:true });
      }

      // Init nach DOM bereit
      function init(){
        populatePlayers();
        watchPlayers();
        renderCurrent();
        $('#ht-save').addEventListener('click', save);
        $('#ht-reset').addEventListener('click', resetEntry);
      }

      if (document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', init, { once:true });
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
