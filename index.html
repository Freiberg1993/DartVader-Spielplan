
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DartVader Turnierplan</title>
  <style>
    /* Basis-Styles f√ºr deine bestehende Seite (leicht lesbar) */
    :root { --fg:#111; --muted:#555; --border:#ddd; --bg:#fff; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.4}
    main{max-width:1000px;margin:24px auto;padding:0 16px}
    h1,h2,h3{margin:0.6em 0}
    table{width:100%;border-collapse:collapse;margin:8px 0 16px;border:1px solid var(--border)}
    th,td{border:1px solid var(--border);padding:6px 8px;text-align:left;vertical-align:top}
    small,em{color:var(--muted)}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin:6px 0 8px}
    .pill{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:2px 8px;background:#f8f8f8}
    .muted{color:var(--muted)}
    /* Platzhalter-Buttons */
    .fake-btn{cursor:default;opacity:.85}
  </style>
</head>
<body>
  <main>
    <h1>DartVader Turnierplan ‚Äì Fairplay strikt (gespielt statt geplant)</h1>
    <h2>DartVader Turnierplan</h2>

    <p>Fairplay-Regeln STRIKT: niemand spielt 2√ó in Folge, niemand wartet 3√ó in Folge. R√ºckrunde automatisch; Grenze konfliktfrei.</p>
    <p class="pill">‚ö°Ô∏è Fairplay aktiv</p>

    <h3>Teilnehmer</h3>

    <div class="controls">
      <span class="pill fake-btn">‚ûï Spieler hinzuf√ºgen</span>
      <span class="pill fake-btn">üßπ Ergebnisse zur√ºcksetzen</span>
    </div>

    <!-- Teilnehmer-Tabelle: Das Widget liest die erste Spalte "Name" -->
    <table id="teilnehmer">
      <tr>
        <th>Name</th>
        <th>Gespielt</th>
        <th>Siege</th>
        <th>Niederlagen</th>
        <th>Aktion</th>
      </tr>
      <!--
        F√ºge hier deine Spielerzeilen hinzu, z. B.:
        <tr><td>Kai</td><td>0</td><td>0</td><td>0</td><td>‚Äì</td></tr>
        <tr><td>Max</td><td>0</td><td>0</td><td>0</td><td>‚Äì</td></tr>
      -->
    </table>

    <p class="muted">Tipp: Namen doppelklicken zum Bearbeiten.</p>

    <h3>Spielplan</h3>
    <div class="controls">
      <span class="pill fake-btn">üîÑ Zuf√§llige Paarungen (FAIR, strikt)</span>
      <span class="pill fake-btn">üîÄ Reihenfolge mischen (FAIR beibehalten)</span>
    </div>

    <h4>Hinrunde</h4>
    <table>
      <tr>
        <th>#</th>
        <th>Spieler A</th>
        <th>Spieler B</th>
        <th>Sieger</th>
      </tr>
    </table>

    <h4>R√ºckrunde</h4>
    <table>
      <tr>
        <th>#</th>
        <th>Spieler A</th>
        <th>Spieler B</th>
        <th>Sieger</th>
      </tr>
    </table>

    <p class="muted">Made for DartVader ‚Ä¢ Lokale Speicherung aktiv</p>
  </main>

  <!-- ====================== -->
  <!--  Widget Drop-in Script -->
  <!-- ====================== -->
  <script>
  /* DartVader ‚Äì H√∂chster Wurf Widget (ohne Datum), v3 ‚Äì robustes Drop-in
     - Baut CSS + HTML selber (keine √Ñnderungen am vorhandenen Markup n√∂tig).
     - Dropdown: liest Teilnehmer aus der ersten Tabelle mit Header "Name" (erste Spalte).
     - Speichert EINEN globalen Eintrag: localStorage('dartHighestNoDateV1').
     - Aktualisiert nur, wenn neuer Wert h√∂her ist.
  */
  (function() {
    const CONFIG = {
      playersTableSelector: 'table',   // erste Tabelle mit Spaltenkopf "Name"
      onlyUpdateIfHigher: true,
      storageKey: 'dartHighestNoDateV1'
    };

    // Warten bis DOM wirklich bereit ist
    const run = () => {
      // CSS injizieren
      const css = `
#highest-throw{position:fixed;top:12px;right:12px;z-index:9999;border:1px solid #ddd;border-radius:8px;padding:12px;background:#fff;width:320px;box-shadow:0 2px 10px rgba(0,0,0,.06);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
#highest-throw h3{margin:0 0 6px 0;font-size:1.05rem}
#ht-status{color:#555;font-size:.85rem}
.ht-grid{display:grid;grid-template-columns:1fr;gap:8px;margin:8px 0}
.ht-field{display:flex;flex-direction:column;gap:6px}
.ht-field>span{font-size:.9rem;color:#555}
.ht-actions{display:flex;gap:8px;flex-wrap:wrap}
.btn-primary{background:#2a7;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
.btn-secondary{background:#eee;color:#333;border:1px solid #ccc;padding:8px 12px;border-radius:6px;cursor:pointer}
.btn-primary:hover{background:#268a60}.btn-secondary:hover{background:#e5e5e5}
#ht-current{font-size:.95rem;margin-top:8px}
#ht-current-line{margin-top:4px}
@media (max-width:560px){#highest-throw{position:static;width:auto;margin:8px}}
      `;
      const styleEl = document.createElement('style');
      styleEl.type = 'text/css';
      styleEl.appendChild(document.createTextNode(css));
      (document.head || document.body || document.documentElement).appendChild(styleEl);

      // Widget erzeugen
      const widget = document.createElement('section');
      widget.id = 'highest-throw';
      widget.setAttribute('aria-label','H√∂chster Wurf');
      widget.innerHTML = `
        <h3>üéØ H√∂chster Wurf</h3>
        <small id="ht-status" aria-live="polite"></small>
        <div class="ht-grid">
          <label class="ht-field">
            <span>Teilnehmer</span>
            <select id="ht-player" aria-label="Teilnehmer ausw√§hlen"></select>
          </label>
          <label class="ht-field">
            <span>H√∂chster Wurf (0‚Äì1000)</span>
            <input type="number" id="ht-score" inputmode="numeric" min="0" max="1000" step="1" placeholder="z.‚ÄØB. 140" />
          </label>
        </div>
        <div class="ht-actions">
          <button id="ht-save" class="btn-primary">Speichern</button>
          <button id="ht-reset" class="btn-secondary" title="Eintrag l√∂schen">Zur√ºcksetzen</button>
        </div>
        <div id="ht-current">
          <strong>Aktueller Eintrag:</strong>
          <div id="ht-current-line">‚Äì noch kein Eintrag ‚Äì</div>
        </div>
      `;
      (document.body || document.documentElement).appendChild(widget);

      // Refs
      const $ = s => document.querySelector(s);
      const els = {
        status: $('#ht-status'),
        player: $('#ht-player'),
        score:  $('#ht-score'),
        save:   $('#ht-save'),
        reset:  $('#ht-reset'),
        currentLine: $('#ht-current-line')
      };

      // Storage
      const readStorage = () => { try { const raw = localStorage.getItem(CONFIG.storageKey); return raw? JSON.parse(raw): null; } catch(e){ return null; } };
      const writeStorage = (obj) => { try { localStorage.setItem(CONFIG.storageKey, JSON.stringify(obj)); } catch(e){} };

      const normalizeName = s => (s||'').toString().trim();
      const uniqSorted = arr => Array.from(new Set(arr.map(normalizeName).filter(Boolean))).sort((a,b)=>a.localeCompare(b,'de'));

      // Teilnehmer einlesen (erste Tabelle mit Header "Name")
      function findPlayersFromTable(){
        const tables = Array.from(document.querySelectorAll(CONFIG.playersTableSelector));
        for (const table of tables) {
          const ths = Array.from(table.querySelectorAll('thead th, tr:first-child th'));
          const hasNameHeader = ths.some(th => /(^|\\s)name(\\s|$)/i.test((th.textContent||'').trim()));
          if (!hasNameHeader) continue;

          const tbodyRows = Array.from(table.querySelectorAll('tbody tr'));
          const rows = tbodyRows.length ? tbodyRows : Array.from(table.querySelectorAll('tr')).slice(1); // Header √ºberspringen

          const names = rows.map(r => {
            const cell = r.querySelector('td, th');
            return cell ? cell.textContent.replace(/\\s+/g,' ').trim() : '';
          }).filter(Boolean);
          if (names.length) return uniqSorted(names);
        }
        return [];
      }

      function populatePlayers(){
        const players = findPlayersFromTable();
        els.player.innerHTML = '';
        if (!players.length) {
          const opt = document.createElement('option'); opt.value=''; opt.textContent='‚Äî keine Spieler gefunden ‚Äî';
          els.player.appendChild(opt);
          els.player.disabled = true;
          els.status.textContent = 'Spielerliste: nicht gefunden (pr√ºfe Tabellenspalte "Name").';
          return;
        }
        for (const name of players) {
          const opt = document.createElement('option'); opt.value=name; opt.textContent=name;
          els.player.appendChild(opt);
        }
        els.player.disabled = false;
        els.status.textContent = 'Spielerliste aus Tabelle geladen.';
      }

      // Beobachten: passt sich an, wenn du Spieler hinzuf√ºgst/√§nderst
      function watchPlayers(){
        const mo = new MutationObserver((mutList)=>{
          if (mutList.some(m => m.addedNodes.length || m.removedNodes.length || m.type === 'childList' || m.type === 'characterData')) {
            const prev = els.player.value;
            populatePlayers();
            if (prev) {
              const opt = Array.from(els.player.options).find(o=>o.value===prev);
              if (opt) els.player.value = prev;
            }
          }
        });
        mo.observe(document.body || document.documentElement, { childList:true, subtree:true, characterData:true });
      }

      function renderCurrent(){
        const rec = readStorage();
        if (rec && rec.name && Number.isFinite(rec.score)) els.currentLine.textContent = `${rec.score} ‚Äì ${rec.name}`;
        else els.currentLine.textContent = '‚Äì noch kein Eintrag ‚Äì';
      }

      function save(){
        const name = normalizeName(els.player.value);
        const score = Number(els.score.value);
        if (!name) return alert('Bitte Teilnehmer w√§hlen.');
        if (!Number.isFinite(score) || score < 0 || score > 1000) return alert('Bitte g√ºltige Punktzahl (0‚Äì1000) eintragen.');
        const current = readStorage();
        if (!CONFIG.onlyUpdateIfHigher || !current || score > current.score) {
          writeStorage({ name, score });
          els.status.textContent = CONFIG.onlyUpdateIfHigher ? 'Rekord aktualisiert ‚úÖ' : 'Eintrag gespeichert.';
          els.score.value = '';
          renderCurrent();
        } else {
          els.status.textContent = `Kein Update: ${score} < ${current.score} (aktueller Wert)`;
        }
      }

      function resetEntry(){
        if (confirm('Eintrag wirklich l√∂schen?')) {
          localStorage.removeItem(CONFIG.storageKey);
          els.status.textContent = 'Eintrag gel√∂scht üóëÔ∏è';
          renderCurrent();
        }
      }

      // Init
      populatePlayers();
      watchPlayers();
      renderCurrent();
      // Events
      els.save.addEventListener('click', save);
      els.reset.addEventListener('click', resetEntry);
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', run, { once: true });
    } else {
      run();
    }
  })();
  </script>
</body>
</html>
``
